<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF51 SDK - S110 SoftDevice: Porting serialization libraries</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51 SDK - S110 SoftDevice
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00113.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Porting serialization libraries </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>BLE serialization is designed in a way that allows the same BLE application code (the <code>main.c</code> file) to be used either on a single chip with a SoftDevice or as application in a serialized system.</p>
<p>If you want to run the application in a serialized system, the application chip must contain serialization libraries in addition to the application itself. These serialization libraries access device-specific resources. Therefore, you must provide device-specific drivers to run a serialized application on the target system. To get started, use one of the serialized BLE example projects for the nRF51 chip that are provided by this SDK. See the following information for details about which resources and corresponding drivers you must provide.</p>
<p>Some common serialization modules that use MCU hardware do not depend on the chosen physical transport layer. The following table below lists these modules and states which corresponding API must be implemented.</p>
<table class="doxtable">
<tr>
<th>Module </th><th>Hardware </th><th>IRQ </th><th>API </th><th>Description</th></tr>
<tr>
<td><code>ser_app_hal_nrf51.c</code> </td><td>- </td><td>SW_IRQ2 </td><td><a class="el" href="a01149.html">Serialization Application Hardware Abstraction Layer</a> </td><td>This module uses SW_IRQ2 to notify the BLE application of events generated by the SoftDevice. You must port this module using the available software interrupt. </td></tr>
<tr>
<td><code>app_timer.c</code> </td><td>RTC </td><td>SW_IRQ0, RTC_IRQ </td><td><a class="el" href="a00987.html">Application Timer</a> </td><td>The <a class="el" href="a00987.html">Application Timer</a> is used in some BLE examples. You must port this module using the available timer. </td></tr>
<tr>
<td><code>pstorage_nosd.c</code> </td><td>NVMC </td><td>- </td><td><a class="el" href="a01271.html">Flash Manager</a> </td><td>The <a class="el" href="a00956.html">Persistent Storage Interface</a> requires access to a non-volatile memory. You must provide a driver for such memory. </td></tr>
<tr>
<td><code>app_mailbox.c</code>, <code>app_scheduler.c</code> </td><td>NVIC </td><td>- </td><td><a class="el" href="a00991.html">Utility Functions and Definitions (Platform)</a> </td><td>You must provide an implementation of the critical_region_enter() and critical_region_exit() functions. </td></tr>
</table>
<p>In addition, you must port the modules that depend on the physical transport layer (PHY) that you use.</p>
<h1><a class="anchor" id="uart_transport"></a>
UART PHY</h1>
<p>For serialization using UART PHY, you must provide a UART hardware driver to substitute the <code>app_uart.c</code> driver (shown in Figure 1). This driver must implement part of the <a class="el" href="a00968.html">UART module</a> API. Additionally, you must port the <code>ser_phy_nrf51_uart.c</code> upper-layer driver, because this driver contains module interrupt enabling and disabling.</p>
<div class="image">
<img src="serialization_porting_guide_uart.png" alt="serialization_porting_guide_uart.png"/>
<div class="caption">
Figure 1: Resources and drivers required for serialization using UART PHY</div></div>
<p><br/>
</p>
<h1><a class="anchor" id="hci_transport"></a>
UART_HCI PHY (reliable UART)</h1>
<p>Similarly as for UART PHY, you must provide a UART hardware driver for UART_HCI PHY to substitute the <code>app_uart.c</code> driver (shown in Figure 2). This driver must implement part of the <a class="el" href="a00968.html">UART module</a> API. UART_HCI has two upper-layer drivers that must be ported: <code>ser_phy_hci_slip.c</code> and <code>ser_phy_hci.c</code>. The latter uses the hardware TIMER and its interrupts TIMER_IRQ.</p>
<div class="image">
<img src="serialization_porting_guide_hci.png" alt="serialization_porting_guide_hci.png"/>
<div class="caption">
Figure 1: Resources and drivers required for serialization using UART_HCI PHY</div></div>
<p><br/>
</p>
<h1><a class="anchor" id="spi_transport"></a>
SPI PHY</h1>
<p>For SPI PHY, you must provide two hardware drivers: an SPI Master driver and a GPIOTE driver (as shown in Figure 3). These drivers must implement parts of the <a class="el" href="a00963.html">SPI Master driver</a> and <a class="el" href="a00978.html">GPIOTE Handler</a> APIs. The <a class="el" href="a00978.html">GPIOTE Handler</a> drive r<code>app_gpio_fast_detect.c</code> is responsible for edge detection on REQ and RDY input lines, which are used for flow control. This driver uses two interrupts: GPIOTE_IRQ and SW_IRQ1. The <a class="el" href="a00963.html">SPI Master driver</a> <code>spi_master.c</code> uses SPI_IRQ. Additionally, <code>ser_phy_nrf51_spi_master.c</code> uses another software interrupt (SW_IRQ3) for scheduling of lower-priority events.</p>
<div class="image">
<img src="serialization_porting_guide_spi.png" alt="serialization_porting_guide_spi.png"/>
<div class="caption">
Figure 1: Resources and drivers required for serialization using SPI PHY</div></div>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="a00003.html">Libraries</a></li><li class="navelem"><a class="el" href="a00109.html">BLE Serialization</a></li>
    <li class="footer">Generated on Thu May 7 2015 14:36:28 for nRF51 SDK - S110 SoftDevice by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
