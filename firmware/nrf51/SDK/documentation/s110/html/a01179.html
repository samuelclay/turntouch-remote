<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF51 SDK - S110 SoftDevice: DFU BLE packet handling in application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51 SDK - S110 SoftDevice
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a01179.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">DFU BLE packet handling in application<div class="ingroups"><a class="el" href="a01279.html">Bootloader/DFU API</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Handling of DFU BLE packets in the application.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gae4d83224a562ad15ffced4e677a950c2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01179.html#gae4d83224a562ad15ffced4e677a950c2">DFU_APP_ATT_TABLE_POS</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:gae4d83224a562ad15ffced4e677a950c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9ba0681cf552c3b8f3ef9c1c35d49b29"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01179.html#ga9ba0681cf552c3b8f3ef9c1c35d49b29">DFU_APP_ATT_TABLE_CHANGED</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ga9ba0681cf552c3b8f3ef9c1c35d49b29"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gacb9c231addcf47494f127d60d875232c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gacb9c231addcf47494f127d60d875232c"></a>
typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01179.html#gacb9c231addcf47494f127d60d875232c">dfu_app_reset_prepare_t</a> )(void)</td></tr>
<tr class="memdesc:gacb9c231addcf47494f127d60d875232c"><td class="mdescLeft">&#160;</td><td class="mdescRight">DFU application reset_prepare function. This function is a callback that allows the application to prepare for an upcoming application reset. <br/></td></tr>
<tr class="separator:gacb9c231addcf47494f127d60d875232c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga0b5bc3c6d3daca444ec05d33d065f369"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01179.html#ga0b5bc3c6d3daca444ec05d33d065f369">dfu_app_on_dfu_evt</a> (<a class="el" href="a00240.html">ble_dfu_t</a> *p_dfu, <a class="el" href="a00237.html">ble_dfu_evt_t</a> *p_evt)</td></tr>
<tr class="memdesc:ga0b5bc3c6d3daca444ec05d33d065f369"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for handling events from the DFU Service.  <a href="#ga0b5bc3c6d3daca444ec05d33d065f369">More...</a><br/></td></tr>
<tr class="separator:ga0b5bc3c6d3daca444ec05d33d065f369"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga46ec5bb0ed70dfa3207ba06a25ce2347"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01179.html#ga46ec5bb0ed70dfa3207ba06a25ce2347">dfu_app_reset_prepare_set</a> (<a class="el" href="a01179.html#gacb9c231addcf47494f127d60d875232c">dfu_app_reset_prepare_t</a> reset_prepare_func)</td></tr>
<tr class="memdesc:ga46ec5bb0ed70dfa3207ba06a25ce2347"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for registering a function to prepare a reset.  <a href="#ga46ec5bb0ed70dfa3207ba06a25ce2347">More...</a><br/></td></tr>
<tr class="separator:ga46ec5bb0ed70dfa3207ba06a25ce2347"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaba97df0355824c35283c712ebdbedd68"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01179.html#gaba97df0355824c35283c712ebdbedd68">dfu_app_dm_appl_instance_set</a> (<a class="el" href="a01223.html#ga3c013385ac2ef5502370f598308d0339">dm_application_instance_t</a> app_instance)</td></tr>
<tr class="memdesc:gaba97df0355824c35283c712ebdbedd68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for setting the Device Manager application instance.  <a href="#gaba97df0355824c35283c712ebdbedd68">More...</a><br/></td></tr>
<tr class="separator:gaba97df0355824c35283c712ebdbedd68"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Handling of DFU BLE packets in the application. </p>
<p>This module implements the handling of DFU packets for switching from an application to the bootloader and start DFU mode. The DFU packets are transmitted over BLE. This module handles only the StartDFU packet, which allows a BLE application to expose support for the DFU Service. The actual DFU Service runs in a dedicated environment after a BLE disconnect and reset of the nRF51 device. The host must reconnect and continue the update procedure with access to the full DFU Service.</p>
<dl class="section note"><dt>Note</dt><dd>The application must propagate DFU events to this module by calling <a class="el" href="a01179.html#ga0b5bc3c6d3daca444ec05d33d065f369">dfu_app_on_dfu_evt</a> from the <a class="el" href="a01198.html#ga4c1ddf1bdd414c49f408f4ffd965fa00">ble_dfu_evt_handler_t</a> callback. </dd></dl>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ga9ba0681cf552c3b8f3ef9c1c35d49b29"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DFU_APP_ATT_TABLE_CHANGED&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Value indicating that the ATT table might have changed. This value will be set in the application-specific context in Device Manager when entering DFU mode. </p>

</div>
</div>
<a class="anchor" id="gae4d83224a562ad15ffced4e677a950c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DFU_APP_ATT_TABLE_POS&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Position for the ATT table changed setting. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gaba97df0355824c35283c712ebdbedd68"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dfu_app_dm_appl_instance_set </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a01223.html#ga3c013385ac2ef5502370f598308d0339">dm_application_instance_t</a>&#160;</td>
          <td class="paramname"><em>app_instance</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for setting the Device Manager application instance. </p>
<p>This function allows to set the <a class="el" href="a01223.html#ga3c013385ac2ef5502370f598308d0339">dm_application_instance_t</a> value that is returned by the Device Manager when the application registers using <a class="el" href="a01225.html#ga5a720f4da49fffa688f596d77951e5b3">dm_register</a>. If this function is not called, it is not be possible to share bonding information from the application to the bootloader/DFU when entering DFU mode.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">app_instance</td><td>Value for the application instance in use. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga0b5bc3c6d3daca444ec05d33d065f369"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dfu_app_on_dfu_evt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00240.html">ble_dfu_t</a> *&#160;</td>
          <td class="paramname"><em>p_dfu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00237.html">ble_dfu_evt_t</a> *&#160;</td>
          <td class="paramname"><em>p_evt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for handling events from the DFU Service. </p>
<p>The application must inject this function into the DFU Service or propagate DFU events to the dfu_app_handler module by calling this function in the application-specific DFU event handler.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_dfu</td><td>Pointer to the DFU Service structure to which the include event relates. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p_evt</td><td>Pointer to the DFU event. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga46ec5bb0ed70dfa3207ba06a25ce2347"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dfu_app_reset_prepare_set </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a01179.html#gacb9c231addcf47494f127d60d875232c">dfu_app_reset_prepare_t</a>&#160;</td>
          <td class="paramname"><em>reset_prepare_func</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for registering a function to prepare a reset. </p>
<p>The provided function is executed before resetting the system into bootloader/DFU mode. By registering this function, the caller is notified before the reset and can thus prepare the application for reset. For example, the application can gracefully disconnect any peers on BLE, turn of LEDS, ensure that all pending flash operations have completed, and so on.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">reset_prepare_func</td><td>Function to be executed before a reset. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu May 7 2015 14:36:38 for nRF51 SDK - S110 SoftDevice by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
