<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF51 SDK - S120 SoftDevice: SWI</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51 SDK - S120 SoftDevice
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00013.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SWI </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The SWI driver provides functions to manage software interrupts (SWI). It allows users to allocate SWIs and pass extra flags to interrupt handler functions.</p>
<h1><a class="anchor" id="swi_usage"></a>
Usage</h1>
<p>Software interrupts are allocated from the available SWI pool. By default, there are six interrupts available: SWI0 to SWI5. Note that this number is decreased if you use a SoftDevice or the Gazell or ESB protocol. For more information about resource usage for a specific protocol library, see the appropriate specification.</p>
<h2><a class="anchor" id="swi_usage_init"></a>
Initialization</h2>
<p>You must initialize the driver by calling the <a class="el" href="a00668.html#ga1f1d64b1f9abf3476683733c0845a2ef">nrf_drv_swi_init</a> function. If initialization is successful, the function returns <a class="el" href="a00745.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a>.</p>
<h2><a class="anchor" id="swi_usage_alloc"></a>
Allocation</h2>
<p>To allocate an interrupt, call the <a class="el" href="a00668.html#ga9707c5cfc723ed10f67c5a73810753bf">nrf_drv_swi_alloc</a> function. As input, you must provide a pointer to the <a class="el" href="a00668.html#gaf4d75a31a62ec35d2667efcbb3421f64">nrf_swi_t</a> variable, an event handler function, and a value that indicates the interrupt priority. If allocation is successful, the function returns <a class="el" href="a00745.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a>, and the provided pointer variable is set.</p>
<h2><a class="anchor" id="swi_usage_event"></a>
Event handler and flags</h2>
<p>When allocating the driver, you must provide a callback function (see <a class="el" href="a00668.html#ga2ad0fc3331fbcf6398d751f16858c228">nrf_swi_handler_t</a>). The arguments for this function are the <a class="el" href="a00668.html#gaf4d75a31a62ec35d2667efcbb3421f64">SWI</a> and some <a class="el" href="a00668.html#ga3958c1f57afcdee82f1d22cc966e7509">user flags</a>. The user flags are represented as bit mask.</p>
<p>To trigger the interrupt, call <a class="el" href="a00668.html#ga31366f910bb2a52eca033847bed37ed6">nrf_drv_swi_trigger</a> with a specific flag number. When an SWI is triggered, the corresponding callback function is called with all specified flags (represented as a bit mask). The flags can be used, for example, for interrupt source tracking, or they can be ignored if not needed. Note that the callback function might be invoked with more than one flag set if the SWI is triggered more than once with different flag numbers from a same or higher priority interrupt handler.</p>
<h2><a class="anchor" id="swi_special_options"></a>
Special options</h2>
<p>To disable specific SWIs from the pool, add a global define during compilation (SWI_DISABLE0 to SWI_DISABLE5). Any disabled SWI will not be allocated and will therefore not be available to the user.</p>
<h1><a class="anchor" id="swi_usage_example"></a>
Example</h1>
<p>See the following code for a usage example. Note that this example is not power optimized.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="a00668.html#gaf4d75a31a62ec35d2667efcbb3421f64" title="SWI channel (unsigned integer).">nrf_swi_t</a> my_swi;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> swi_event_handler(<a class="code" href="a00668.html#gaf4d75a31a62ec35d2667efcbb3421f64" title="SWI channel (unsigned integer).">nrf_swi_t</a> swi, <a class="code" href="a00668.html#ga3958c1f57afcdee82f1d22cc966e7509" title="SWI user flags (unsigned integer).">nrf_swi_flags_t</a> flags)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* If &quot;my_swi&quot; was triggered and flag #3 is present... */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((swi == my_swi) &amp;&amp; (flags &amp; (1 &lt;&lt; 3)))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Do something. */</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">    ....</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="a00687.html#gaf6c20fb483036617204f12e99e0b997b" title="API Result.">ret_code_t</a> err_code;</div>
<div class="line"><a class="code" href="a00668.html#gaf4d75a31a62ec35d2667efcbb3421f64" title="SWI channel (unsigned integer).">nrf_swi_t</a> my_swi;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Initialize the library. */</span></div>
<div class="line">err_code = <a class="code" href="a00668.html#ga1f1d64b1f9abf3476683733c0845a2ef" title="Function for initializing the SWI module.">nrf_drv_swi_init</a>();</div>
<div class="line"><a class="code" href="a00684.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Allocate and setup one SWI. */</span></div>
<div class="line">err_code = <a class="code" href="a00668.html#ga9707c5cfc723ed10f67c5a73810753bf" title="Function for allocating a first unused SWI instance and setting a handler.">nrf_drv_swi_alloc</a>(&amp;my_swi, swi_event_handler, APP_IRQ_PRIORITY_LOW);</div>
<div class="line"><a class="code" href="a00684.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Trigger SWI with flag #3. */</span></div>
<div class="line">    <a class="code" href="a00668.html#ga31366f910bb2a52eca033847bed37ed6" title="Function for triggering the SWI.">nrf_drv_swi_trigger</a>(my_swi, 3);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Wait for a second. */</span></div>
<div class="line">    nrf_delay_ms(1000);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="swi_with_sd"></a>
Usage with a SoftDevice</h1>
<p>The library can be used with a SoftDevice. However, the amount of interrupts that are available to the user will be limited in this case. See the SoftDevice specification for more information about the resource usage.</p>
<p>Be careful when specifying APP_IRQ_PRIORITY_HIGH as SWI priority. Long interrupt routines with high priority might affect the proper operation of the SoftDevice. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="a00002.html">Hardware Drivers</a></li>
    <li class="footer">Generated on Thu May 7 2015 14:36:45 for nRF51 SDK - S120 SoftDevice by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
