<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF51 SDK - S210 SoftDevice: Experimental: Relay</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51 SDK - S210 SoftDevice
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00070.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Experimental: Relay </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The ANT Relay Example demonstrates how to create a simple relay network. It uses ANT's multi-endpoint and proximity pairing capabilities to achieve this goal.</p>
<h1><a class="anchor" id="ant_examples_relay_description"></a>
Description</h1>
<p>In this example, the state of an LED is relayed to all boards in a network. The boards are connected in a daisy chain to form the nodes of the network. There is no limitation on the number of nodes.</p>
<p>If the state of the LED on one board changes, this change is relayed to all other nodes in the network, so that the state of the LEDs on all boards change. The change can be initiated by pressing a button on one of the boards or by connecting to one of the nodes wirelessly, by using a mobile or computer application.</p>
<div class="image">
<img src="ant_relay.svg" alt="ant_relay.svg"/>
<div class="caption">
ANT relay example with three nodes</div></div>
<p> This example can be extended to fixed topologies that report status or accept commands, and require range extension through relay. This network configuration is appropriate for coin-cell operated networks and applications that require a mobile interface.</p>
<p>After startup or reset, each ANT node opens two master channels: one that is used for the relay network and one that allows for connections to a mobile or computer application, for example ANTware II.</p>
<p>The following table lists the channel parameters for the two master channels (numbers in parentheses denote the parameters that should be used to set the values):</p>
<table class="doxtable">
<tr>
<th>Parameter </th><th>Relay channel </th><th>Mobile channel</th></tr>
<tr>
<td>Channel type </td><td>Master (0x10) </td><td>Master (0x10) </td></tr>
<tr>
<td>Network </td><td>Public [E8, E4, 21, 3B, 55, 7A, 67, C1] </td><td>Public [E8, E4, 21, 3B, 55, 7A, 67, C1] </td></tr>
<tr>
<td>Frequency </td><td>2472 MHz </td><td>2477 MHz </td></tr>
<tr>
<td>Period </td><td>4 Hz (8192) </td><td>4 Hz (8192) </td></tr>
<tr>
<td>Device number </td><td>Serial number </td><td>Serial number </td></tr>
<tr>
<td>Device type </td><td>1 </td><td>2 </td></tr>
<tr>
<td>Transmission type </td><td>5 </td><td>5 </td></tr>
</table>
<p>This example uses proximity pairing to establish a connection between the boards. Boards can be paired by pressing a button or by sending a pairing command over the mobile channel (see <a class="el" href="a00070.html#ant_examples_relay_mobile_format">Message format for computer or mobile applications</a>). Boards must be brought very close (&lt; 10 centimeters) to each other to pair because the proximity bin setting is 1. After a connection to a node in the network is made, the state of the LED on the added board is relayed to all boards in the network.</p>
<p>If a slave channel loses connection with the master to which it is connected for longer than 30 seconds, it will close its channel and re-initialize the search proximity bin setting. To re-initialize the connection, press the appropriate button or send a pairing command over the mobile channel.</p>
<h1><a class="anchor" id="ant_examples_relay_message_format"></a>
Message format</h1>
<p>The relay channel is bi-directional, which means that the slave endpoint sends a status message back to the master for every message that it receives.</p>
<p>The following table lists the message format of the 8-byte message that is used to relay information between devices, both from master to slave and from slave to master:</p>
<table class="doxtable">
<tr>
<th>Byte </th><th>Description</th></tr>
<tr>
<td>0 </td><td>Page number = 1 (ANT_RELAY_MAIN_PAGE) </td></tr>
<tr>
<td>1 </td><td>LED status (1 = ON, 0 = OFF) </td></tr>
<tr>
<td>2-5 </td><td>Counter (4 bytes, unsigned, little endian) that increases every time when the state of a LED changes. When the counter changes, the node changes the state of its LED to reflect the change. </td></tr>
<tr>
<td>6 </td><td>Reserved = 0xFF </td></tr>
<tr>
<td>7 </td><td>State of the slave channel (0 = unassigned, 1 = assigned, 2 = searching, 3 = tracking) </td></tr>
</table>
<p>Whenever the state of the LED changes, the counter will increase. All boards will then update the state of their LED to reflect the new state. The state of the LED can be changed by pressing a button on any of the boards or by sending the appropriate command over the mobile channel.</p>
<h1><a class="anchor" id="ant_examples_relay_mobile_format"></a>
Message format for computer or mobile applications</h1>
<p>Instead of pressing buttons on a board to pair devices or change the state of a LED, you can also send commands from the computer or mobile application. The following table lists the message format that must be used to send commands to the boards:</p>
<table class="doxtable">
<tr>
<th>Byte </th><th>Description</th></tr>
<tr>
<td>0 </td><td>Page number = 2 (ANT_MOBILE_COMMAND_PAGE) </td></tr>
<tr>
<td>1 </td><td>Reserved = 0xFF </td></tr>
<tr>
<td>2 </td><td>Command (1 = pair, 2 = LED on, 3 = LED off) </td></tr>
<tr>
<td>3-7 </td><td>Reserved = 0xFF </td></tr>
</table>
<p>Commands can be sent using broadcast messages or acknowledged messages. If possible, you should always use acknowledged messages because this message type returns a notification stating if the command was received successfully or not.</p>
<p>The status message that is sent on the mobile channel to the computer or mobile application is almost identical to the status message that is sent on the relay channel. However, it does not use a counter.</p>
<p>The following table lists the message format of the status message that is sent on the mobile channel:</p>
<table class="doxtable">
<tr>
<th>Byte </th><th>Description</th></tr>
<tr>
<td>0 </td><td>Page number = 1 (ANT_MOBILE_MAIN_PAGE) </td></tr>
<tr>
<td>1 </td><td>LED status (1 = ON, 0 = OFF) </td></tr>
<tr>
<td>2-6 </td><td>Reserved = 0xFF </td></tr>
<tr>
<td>7 </td><td>State of the slave channel (0 = unassigned, 1 = assigned, 2 = searching, 3 = tracking) </td></tr>
</table>
<h1><a class="anchor" id="ant_examples_relay_setup"></a>
Setup</h1>
<p>The name of the example is <b>ant_relay_demo_pca10028</b>. If you are not using the Keil Pack Installer, you can find the source code and project file of the example in the following folder: <code>&lt;InstallFolder&gt;\examples\ant\experimental\ant_relay_demo</code> </p>
<p>At least two development boards are required to use the ANT relay example. Optionally, if you want to use a mobile channel, an ANT USB dongle and ANTware II are required.</p>
<p>The following table lists the function of the buttons and LEDs on the development board:</p>
<table class="doxtable">
<tr>
<th>Hardware </th><th>Function</th></tr>
<tr>
<td>Button 1 </td><td>Toggle the state of LED 1 </td></tr>
<tr>
<td>Button 2 </td><td>Start pairing mode </td></tr>
<tr>
<td>LED 1 </td><td>Toggled by button 1 </td></tr>
<tr>
<td>LED 2 </td><td>Default: off. Is turned on when the slave endpoint receives a message. </td></tr>
</table>
<h1><a class="anchor" id="ant_examples_relay_testing"></a>
Testing</h1>
<p>Test the ANT Relay Example application by performing the following steps:</p>
<ol type="1">
<li>Compile and program the application and toggle the power or reset each of the boards. The master channels will start transmitting at the channel period, but the boards will not be connected. This means that pressing button 1 on a board will affect the state of LED 1 of that board, but not of the other boards. LED 2 is off because no messages have been received on the slave endpoint.</li>
<li>To pair boards, press button 2 on the board that you want to add as a new node. This will open the slave endpoint, and the board will begin searching for other devices in the proximity pairing zone.</li>
<li>Bring the board that you want to add close to the other board or, if you already connected several boards, to the last board that was added to the network. When the slave endpoint of the new board receives data from the other board, LED 2 will be turned on. <div class="image">
<img src="ant_relay_pairing.svg" alt="ant_relay_pairing.svg"/>
<div class="caption">
Pairing node B with node A</div></div>
 After the boards are connected, they will continue communicating even if they are moved further apart.</li>
<li>You can add more boards to the network by repeating steps 2 and 3. Make sure to connect the boards in a chain.</li>
<li>Press button 1 on one of the boards in the network. The state of the LED 1 will toggle on all connected boards. There will be a slight latency while the message is sent across the relay.</li>
</ol>
<p>Optionally, test the relay network by using a mobile channel by performing the following steps:</p>
<ol type="1">
<li>Ensure that an ANT USB dongle is connected to the computer.</li>
<li>Start ANTware II and configure the mobile channel as a slave channel. For all parameters except the channel type, refer to the channel information in the table above. Set the device number to 0.</li>
<li><p class="startli">To turn the LED on, issue the following command as described in <a class="el" href="a00070.html#ant_examples_relay_mobile_format">Message format for computer or mobile applications</a>:</p>
<p class="startli">02-FF-<b>02</b>-FF-FF-FF-FF-FF</p>
<p class="startli">Use acknowledged messages to send commands.</p>
</li>
<li><p class="startli">To turn the LED off, issue the following command:</p>
<p class="startli">02-FF-<b>03</b>-FF-FF-FF-FF-FF</p>
</li>
<li><p class="startli">To initiate pairing, issue the following command:</p>
<p class="startli">02-FF-<b>01</b>-FF-FF-FF-FF-FF </p>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="a00004.html">Examples</a></li><li class="navelem"><a class="el" href="a00061.html">ANT</a></li>
    <li class="footer">Generated on Thu May 7 2015 14:37:17 for nRF51 SDK - S210 SoftDevice by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
