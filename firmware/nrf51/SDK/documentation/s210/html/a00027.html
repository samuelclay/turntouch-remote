<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF51 SDK - S210 SoftDevice: PWM library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51 SDK - S210 SoftDevice
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00027.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">PWM library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The pulse-width modulation (PWM) library provides functions to generate a pulse-width modulated output signal.</p>
<p>Key features include:</p>
<ul>
<li>Up to three independent PWM instances.</li>
<li>Two PWM output channels per instance.</li>
<li>Minimal CPU usage.</li>
<li>Configurable per-channel polarity.</li>
</ul>
<h1><a class="anchor" id="lib_pwm_resources"></a>
Resource usage</h1>
<p>Users can create multiple instances of the library. The PWM library allocates a timer instance (see <a class="el" href="a00014.html">Timer</a>) that is not available to the user. Therefore, the number of independent PWM instances depends on the number of hardware timers.</p>
<p>Resource usage:</p>
<ul>
<li>2 PPI channels per instance + 2 PPI channels per PWM channel.</li>
<li>1 PPI group per instance.</li>
<li>1 GPIOTE channel per PWM channel.</li>
</ul>
<p>For example, a PWM instance with two channels will consume 2+4 PPI channels, 1 PPI group, and 2 GPIOTE channels.</p>
<p>The PPI and GPIOTE channels are allocated by the <a class="el" href="a00008.html">PPI</a> and <a class="el" href="a00006.html">GPIOTE</a> drivers.</p>
<h1><a class="anchor" id="lib_pwm_init"></a>
Initialization and configuration</h1>
<p>To use the PWM library, you must create one or more PWM instances by calling the <a class="el" href="a00365.html#gaf01d3e06e17705a7453d91c70d40098f">APP_PWM_INSTANCE</a> macro. Note that each instance will utilize a hardware timer, which will be unavailable for other uses. Changing the timer parameters during PWM operation will result in undefined behavior.</p>
<p>The following code shows how to create a new PWM instance: </p>
<div class="fragment"><div class="line"><a class="code" href="a00365.html#gaf01d3e06e17705a7453d91c70d40098f" title="Macro for creating a PWM instance.">APP_PWM_INSTANCE</a>(PWM0,0);  <span class="comment">// Create the instance &quot;PWM0&quot; using TIMER0.</span></div>
</div><!-- fragment --><h2><a class="anchor" id="lib_pwm_init_config"></a>
Configuration</h2>
<p>After creating an instance, you must initialize it by providing an <a class="el" href="a00073.html">app_pwm_config_t</a> structure with the default or custom configuration. See the <a class="el" href="a00365.html#ga530dc15dff207529ff582c38d912a0bb">APP_PWM_DEFAULT_CONFIG_1CH</a> and <a class="el" href="a00365.html#ga0ab3501072119588eb8bea06efe10350">APP_PWM_DEFAULT_CONFIG_2CH</a> macros for default configurations for one or two channels, respectively.</p>
<p>The following parameters must be specified:</p>
<ul>
<li><b>pins</b>: Array of two unsigned integers that indicate which physical pins will be used for the PWM output. In one-channel mode, the second element is ignored.</li>
<li><b>pin_polarity</b>: 2-element array of <a class="el" href="a00365.html#ga58cb721dc6ca8fdea7907bbd8cedbced">app_pwm_polarity_t</a> that indicates the output signal polarity. In one-channel mode, the second element is ignored.</li>
<li><b>num_of_channels</b>: Number of PWM channels (1 or 2).</li>
<li><b>period_us</b>: Signal period (in microseconds).</li>
</ul>
<h2><a class="anchor" id="lib_pwm_init_events"></a>
Event handler</h2>
<p>You should provide a callback function (see <a class="el" href="a00365.html#gad3bf7e6112f09b1cfcc5167819f825db">app_pwm_callback_t</a>) that will be executed when the PWM state changes from BUSY to READY.</p>
<p>Also see the <a class="el" href="a00027.html#limitations">Limitations</a> section.</p>
<h2><a class="anchor" id="lib_pwm_init_events_qs"></a>
Procedure</h2>
<p>Complete the following steps to generate a PWM signal:</p>
<ol type="1">
<li>Create and initialize a <a class="el" href="a00073.html">app_pwm_config_t</a> structure as described in the <a class="el" href="a00027.html#lib_pwm_init_config">Configuration</a> section.</li>
<li>Initialize an instance using <a class="el" href="a00365.html#gae3b3e1d5404fd776bbf7bf22224b4b0d">app_pwm_init</a>, with pointers to the instance, the configuration structure, and the callback function as parameters. The function will return <a class="el" href="a00385.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a> on success or an error code on failure. Initialization will fail if the instance was already initialized, if an invalid configuration was provided, or if there were not enough free resources.</li>
<li>Call <a class="el" href="a00365.html#ga94f5d824afec86aff163f7cccedaa436">app_pwm_enable</a> to enable the instance.</li>
<li>Use <a class="el" href="a00365.html#ga527284cf3a5f6d50af42d13d83cfa139">app_pwm_channel_duty_set</a> to set the duty cycle.</li>
</ol>
<p>A PWM signal should now appear on the output pin. No CPU time is used during operation.</p>
<h1><a class="anchor" id="limitations"></a>
Limitations</h1>
<ul>
<li>A duty cycle change takes up to two full PWM cycles (two short interrupt routine calls at the end of each cycle). During the duty change process, no changes can be performed on the second channel, and <a class="el" href="a00365.html#ga527284cf3a5f6d50af42d13d83cfa139">app_pwm_channel_duty_set</a> returns <a class="el" href="a00385.html#ga5d2d8608f6d6a0329f58961a969e946e">NRF_ERROR_BUSY</a>. After the change is complete, the user callback function is called.</li>
<li>PWM frequency is limited to 200 kHz (5 microseconds period). Exceeding this value might introduce glitches in the output signal.</li>
</ul>
<h1><a class="anchor" id="usage_example"></a>
Example</h1>
<p>See the following code for a usage example. Note that this example is not power optimized.</p>
<div class="fragment"><div class="line"><a class="code" href="a00365.html#gaf01d3e06e17705a7453d91c70d40098f" title="Macro for creating a PWM instance.">APP_PWM_INSTANCE</a>(PWM1,1);                   <span class="comment">// Create the instance &quot;PWM1&quot; using TIMER1.</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> pwm_ready_callback(uint32_t pwm_id)    <span class="comment">// PWM callback function</span></div>
<div class="line">{</div>
<div class="line">    </div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">    ...</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="a00374.html#gaf6c20fb483036617204f12e99e0b997b" title="API Result.">ret_code_t</a> err_code;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* 2-channel PWM, 200 Hz, output on DK LED pins. */</span></div>
<div class="line"><a class="code" href="a00073.html" title="PWM configuration structure used for initialization.">app_pwm_config_t</a> pwm1_cfg = <a class="code" href="a00365.html#ga0ab3501072119588eb8bea06efe10350" title="PWM instance default configuration (2 channels).">APP_PWM_DEFAULT_CONFIG_2CH</a>(5000L, BSP_LED_0, BSP_LED_1);</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Switch the polarity of the second channel. */</span></div>
<div class="line">pwm1_cfg.pin_polarity[1] = APP_PWM_POLARITY_ACTIVE_HIGH;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Initialize and enable PWM. */</span></div>
<div class="line">err_code = <a class="code" href="a00365.html#gae3b3e1d5404fd776bbf7bf22224b4b0d" title="Function for initializing a PWM instance.">app_pwm_init</a>(&amp;PWM1,&amp;pwm1_cfg,pwm_ready_callback);</div>
<div class="line"><a class="code" href="a00371.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
<div class="line"><a class="code" href="a00365.html#ga94f5d824afec86aff163f7cccedaa436" title="Function for enabling a PWM instance after initialization.">app_pwm_enable</a>(&amp;PWM1);</div>
<div class="line"></div>
<div class="line">uint32_t value;</div>
<div class="line"><span class="keywordflow">while</span>(<span class="keyword">true</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; 40; ++i)</div>
<div class="line">    {</div>
<div class="line">        value = (i &lt; 20) ? (i * 5) : (100 - (i - 20) * 5);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">/* Se the duty cycle - keep trying until PWM is ready. */</span></div>
<div class="line">        <span class="keywordflow">while</span> (<a class="code" href="a00365.html#ga527284cf3a5f6d50af42d13d83cfa139" title="Function for setting the PWM channel duty cycle in percents.">app_pwm_channel_duty_set</a>(&amp;PWM1, 0, value) == <a class="code" href="a00385.html#ga5d2d8608f6d6a0329f58961a969e946e" title="Busy.">NRF_ERROR_BUSY</a>);</div>
<div class="line">        <span class="keywordflow">while</span> (<a class="code" href="a00365.html#ga527284cf3a5f6d50af42d13d83cfa139" title="Function for setting the PWM channel duty cycle in percents.">app_pwm_channel_duty_set</a>(&amp;PWM1, 1, value) == <a class="code" href="a00385.html#ga5d2d8608f6d6a0329f58961a969e946e" title="Busy.">NRF_ERROR_BUSY</a>);</div>
<div class="line">        nrf_delay_ms(25);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="usage_with_sd"></a>
Usage with a SoftDevice</h1>
<p>The PWM library can be used with a SoftDevice. However, there are some limitations:</p>
<ul>
<li>TIMER0 is reserved for the SoftDevice and not available to user. Attempting to initialize an instance using TIMER0 will result in a hard fault due to memory access violation.</li>
<li>The SoftDevice can interrupt the application at any time for a certain amount of time. In this case, the duty cycle change might take more than two PWM timer cycles. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="a00003.html">Libraries</a></li>
    <li class="footer">Generated on Thu May 7 2015 14:37:17 for nRF51 SDK - S210 SoftDevice by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
