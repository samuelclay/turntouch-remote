<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF51 SDK - S210 SoftDevice: Experimental: Background Scanning</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51 SDK - S210 SoftDevice
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00063.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Experimental: Background Scanning </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The ANT Background Scanning Example shows how to implement a background scanning channel in combination with a master channel on a single device. It also demonstrates how to use extended messages to obtain Received Signal Strength Indication (RSSI) and channel ID information from received packets.</p>
<h1><a class="anchor" id="ant_examples_scanning_description"></a>
Description</h1>
<p>Background scanning channels in ANT are searching channels that never synchronize with a master. Instead of acquiring a master, ANT will pass the data to the master and continue searching. These channels allow for asynchronous topologies with other channels running independently on the same device. For more information about background scanning channels and channel parameters, see the <a href="http://www.thisisant.com/resources/ant-message-protocol-and-usage/">ANT Message Protocol and Usage</a> documentation and the <a href="http://www.thisisant.com/developer/resources/downloads/#documents_tab">ANT Channel Search and Background Scanning Channel</a> application note.</p>
<p>This example uses two channels: one background scanning channel that can receive data from multiple devices and one master channel. The master channel in this example copies the received RSSI and channel ID information and mirrors these parameters back to the transmitting devices.</p>
<div class="image">
<img src="ant_background_scanning.svg" alt="ant_background_scanning.svg"/>
<div class="caption">
Background scanning and transmitting on master with two nodes</div></div>
<p> After startup or reset, each ANT node opens one background scanning channel and one master channel. The background scanning channel is configured similar to a regular slave channel, but with a special flag set to denote its function. The search time-out is set to infinity to ensure that the background scanning channel continues searching for other channels.</p>
<p>The following table lists the ANT channel parameters for the master channel and the background scanning channel (numbers in parentheses denote the parameters that should be used to set the values):</p>
<table class="doxtable">
<tr>
<th>Parameter </th><th>Master channel </th><th>Background scanning channel</th></tr>
<tr>
<td>Channel type </td><td>Master (0x10) </td><td>Slave(0x00) </td></tr>
<tr>
<td>Extended assignment </td><td>EXT_PARAM_ALWAYS_SEARCH (0x01) </td><td>N/A </td></tr>
<tr>
<td>Network </td><td>Public [E8, E4, 21, 3B, 55, 7A, 67, C1] </td><td>Public [E8, E4, 21, 3B, 55, 7A, 67, C1] </td></tr>
<tr>
<td>Frequency </td><td>2477 MHz </td><td>2477 MHz </td></tr>
<tr>
<td>Period </td><td>16 Hz (2048) </td><td>N/A </td></tr>
<tr>
<td>Device number </td><td>Serial number </td><td>Wildcard (0) </td></tr>
<tr>
<td>Device type </td><td>1 </td><td>1 </td></tr>
<tr>
<td>Transmission type </td><td>5 </td><td>5 </td></tr>
<tr>
<td>Search time-out (high priority) </td><td>N/A </td><td>No HP search (0) </td></tr>
<tr>
<td>Search time-out (low priority) </td><td>N/A </td><td>Infinite (255) </td></tr>
</table>
<h1><a class="anchor" id="ant_examples_scanning_message_format"></a>
Message format</h1>
<p>The master channel on each device sends a single payload of data. This payload indicates the signal strength and the channel ID of the last message that was received on the background scanning channel.</p>
<p>The following table shows the message format of the default master message:</p>
<table class="doxtable">
<tr>
<th>Byte </th><th>Description</th></tr>
<tr>
<td>0 </td><td>Page number = 1 (ANT_BEACON_PAGE) </td></tr>
<tr>
<td>1 </td><td>RSSI value (signed dBm value, corresponding to the device number) </td></tr>
<tr>
<td>2-3 </td><td>Device number of the last message that was received on the background scanning channel (little endian, corresponding to the RSSI value) </td></tr>
<tr>
<td>4-5 </td><td>Reserved </td></tr>
<tr>
<td>6 </td><td>Counter that increases with each channel period </td></tr>
<tr>
<td>7 </td><td>Number of messages that were received on the background scanning channel </td></tr>
</table>
<h1><a class="anchor" id="ant_examples_scanning_setup"></a>
Setup</h1>
<p>The name of the example is <b>experimental_ant_background_scanning_pca10028</b>. If you are not using the Keil Pack Installer, you can find the source code and project file of the example in the following folder: <code>&lt;InstallFolder&gt;\examples\ant\experimental\ant_background_scanning</code> </p>
<p>The ANT background scanning example uses a single development board in combination with an nRF51 ANT USB dongle and ANTware II, but it can be adapted to work with any number of nodes. In this example, ANTware II will be configured to use one slave channel to track the master channel of one single device. In addition, a master channel in ANTware II will transmit to the background scanning channel on the device. Note that any number of channels could be configured in ANTware II to transmit to the background scanning channel on the device.</p>
<div class="image">
<img src="ant_background_scanning_setup.svg" alt="ant_background_scanning_setup.svg"/>
<div class="caption">
Setup of the ANT Background scanning example</div></div>
<p> The example does not use any buttons or LEDs.</p>
<h1><a class="anchor" id="ant_examples_scanning_testing"></a>
Testing</h1>
<p>Test the ANT Background Scanning Example application by performing the following steps:</p>
<ol type="1">
<li>Compile and program the application and toggle the power or reset the development board. The background scanning channel and the master channel will start immediately.</li>
<li>Ensure that an ANT USB dongle is connected to the computer.</li>
<li><p class="startli">Start ANTware II and configure the following channels:</p>
<ul>
<li>A slave channel with device number 0. Configure the channel according to the information for the master channel as shown in the table above, but configure it to be a slave channel.</li>
<li>A master channel with a device number other than 0. Configure the channel according to the information for the master channel as shown in the table above.</li>
</ul>
<p class="startli">The background scanning channel on the device will now receive data from the ANTware II master channel. The master channel on the device will then transmit this data back to the ANTware II slave channel.</p>
</li>
<li>In ANTware II, check the message payload that is received on the slave channel. The reported device number (byte 2 and 3) is the channel ID that you configured for the master channel. The reported RSSI value (byte 1) changes when the board is moved closer or further away from the ANT USB dongle. For example: <table class="doxtable">
<tr>
<th>Payload </th><th>Description</th></tr>
<tr>
<td>Received BROADCAST_DATA_0x4E :: 4e, 00-01-B6-<b>32-00</b>-00-00-8D-74 </td><td>Device number = 50 </td></tr>
<tr>
<td>Received BROADCAST_DATA_0x4E :: 4e, 00-01-<b>B6</b>-32-00-00-00-8E-74 </td><td>RSSI = -74 dBm (further away) </td></tr>
<tr>
<td>Received BROADCAST_DATA_0x4E :: 4e, 00-01-<b>CB</b>-32-00-00-00-8A-0C </td><td>RSSI = -53 dBm (closer) </td></tr>
</table>
</li>
<li>You can configure more master channels in ANTware II. Each channel must use a different device number. The background scanning channel on the device will receive messages from all channels asynchronously and report the received data back to the slave channel. </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="a00004.html">Examples</a></li><li class="navelem"><a class="el" href="a00061.html">ANT</a></li>
    <li class="footer">Generated on Thu May 7 2015 14:37:17 for nRF51 SDK - S210 SoftDevice by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
